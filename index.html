<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GUÍA INTEGRAL: TICS y Soberanía Tecnológica (PNB-UNES)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración de Fuentes y Colores (Estilo UNES/Seguridad) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'unes-blue': '#1e40af', // Tonalidad de azul oscuro para énfasis
                        'unes-light': '#bfdbfe', // Azul claro para fondos
                        'unes-accent': '#f59e0b', // Naranja/Ámbar para acentos de alerta/IA
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilos Andragógicos y de Accesibilidad */
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .section-header {
            cursor: pointer;
            transition: background-color 0.3s;
            border-radius: 0.5rem;
        }
        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
        }
        .section-content.expanded {
            max-height: 5000px; /* Suficientemente grande para todo el contenido */
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        .loading-spinner {
            border-top-color: transparent;
            border-left-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <!-- 🚨 IMPORTANTE: CONFIGURACIÓN DE LA CLAVE API 🚨 -->
    <!-- 
        Si está ejecutando este archivo fuera del entorno de desarrollo (ej: en GitHub Pages),
        DEBE obtener su propia clave de API de Gemini y colocarla aquí.
        De lo contrario, obtendrá un error de "conexión" o "autenticación".
        
        EJEMPLO: const apiKey = "AQUI_VA_TU_CLAVE_PERSONAL_DE_GEMINI";
        
        Dejamos la cadena vacía para que funcione en el entorno actual de desarrollo.
    -->
    <script>const apiKey = "AIzaSyAvHg3T7p875lEIyJS3MVz0MsJUHM070MM";</script>

    <!-- Header Fijo y Título Principal (Z-INDEX: 50) -->
    <header class="bg-unes-blue text-white shadow-lg p-4 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl sm:text-2xl font-extrabold tracking-tight">
                Guía Integral: TICs y Soberanía Tecnológica
            </h1>
            <button id="btn-toggle-ia-modal" class="bg-unes-accent hover:bg-yellow-600 text-unes-blue font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-md">
                <span class="sm:inline hidden">Asistente IA</span>
                <span class="sm:hidden inline">🤖</span>
            </button>
        </div>
    </header>

    <!-- Contenido Principal (Main Layout) -->
    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 flex flex-col lg:flex-row gap-8">

        <!-- Panel de Navegación (Semanas) (Z-INDEX: 40) -->
        <nav class="lg:w-1/4 w-full bg-white p-4 rounded-xl shadow-lg h-fit sticky top-20 z-40">
            <h2 class="text-lg font-bold text-unes-blue mb-4 border-b pb-2">Plan de Estudio (6 Semanas)</h2>
            <ul id="week-nav" class="space-y-2">
                <!-- Botones de Semanas generados por JS -->
            </ul>
        </nav>

        <!-- Área de Contenido de la Guía -->
        <section id="content-area" class="lg:w-3/4 w-full">
            <h2 id="current-week-title" class="text-3xl font-extrabold text-gray-800 mb-6">Seleccione una Semana</h2>

            <!-- Contenedor para la Alerta de IA -->
            <div id="ai-alert-container" class="mb-6 hidden">
                <div class="bg-unes-accent border-l-4 border-yellow-700 text-gray-900 p-4 rounded-lg" role="alert">
                    <p class="font-bold">Herramienta de IA Disponible:</p>
                    <p class="text-sm" id="ai-alert-message"></p>
                    <button onclick="document.getElementById('btn-toggle-ia-modal').click()" class="mt-2 text-xs font-semibold underline hover:text-unes-blue">
                        Abrir Asistente
                    </button>
                </div>
            </div>

            <div id="week-content-container" class="space-y-8">
                <!-- El contenido detallado de la semana se insertará aquí por JS -->
            </div>
        </section>
    </main>

    <!-- Modal del Asistente de Inteligencia Artificial (AI) (Z-INDEX: 50) -->
    <div id="ai-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl card-shadow w-full max-w-lg p-6">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-2xl font-bold text-unes-blue">🤖 Asistente de IA TICs PNB</h3>
                    <button onclick="document.getElementById('ai-modal').classList.add('hidden')" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
                </div>

                <!-- Selector de Herramienta -->
                <div class="mb-4">
                    <label for="ai-tool-selector" class="block text-sm font-medium text-gray-700 mb-1">Selecciona la Herramienta:</label>
                    <select id="ai-tool-selector" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-unes-blue focus:border-unes-blue">
                        <option value="explicador">Explicador de Conceptos (Todas las Semanas)</option>
                        <option value="actas">Asistente de Actas (Semana 2)</option>
                        <option value="generador_casos">Generador de Casos Éticos (Semana 6)</option>
                    </select>
                </div>

                <!-- Interfaz de Input (Dinámica) -->
                <div id="ai-input-interface">
                    <!-- Contenido de input dinámico -->
                </div>

                <!-- Botón y Spinner de Carga -->
                <div class="flex items-center space-x-4 mt-4">
                    <button id="ai-run-button" class="flex-1 bg-unes-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex justify-center items-center" disabled>
                        <span id="ai-run-button-text">Seleccione una herramienta...</span>
                        <div id="ai-loading-spinner" class="w-4 h-4 border-2 border-white rounded-full loading-spinner ml-2 hidden"></div>
                    </button>
                </div>

                <!-- Área de Resultados -->
                <div class="mt-6 border-t pt-4">
                    <h4 class="text-md font-bold text-gray-800 mb-2">Resultado de la IA:</h4>
                    <div id="ai-result-area" class="bg-gray-50 p-4 rounded-lg text-sm text-gray-700 border border-gray-200 min-h-[100px] whitespace-pre-wrap">
                        El resultado de la Inteligencia Artificial aparecerá aquí.
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Script de Navegación y Lógica de IA -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const weeks = [
                {
                    id: 'semana-1', title: 'Semana 1: Soberanía Tecnológica y PC',
                    purpose: 'Comprender la computadora como herramienta esencial para el servicio policial y diferenciar el Hardware del Software bajo una óptica de soberanía tecnológica.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">La Computadora como Sistema Básico de Gestión y Respuesta</h4>
                        <p class="mb-3">Más que una máquina, es un conjunto de componentes interconectados que procesan información crítica, desde datos ciudadanos hasta patrones delictivos, generando resultados útiles para la seguridad y la ciudadanía.</p>

                        <h5 class="text-lg font-medium mb-1 mt-3 text-gray-700">Hardware (Lo tangible)</h5>
                        <p class="mb-3">Componentes físicos esenciales para el procesamiento de la información (CPU, Memoria RAM, Almacenamiento, Periféricos E/S). Su gestión y mantenimiento son vitales para la operatividad del Estado.</p>

                        <h5 class="text-lg font-medium mb-1 mt-3 text-gray-700">Software (Lo intangible)</h5>
                        <p class="mb-3">Programas e instrucciones que dotan de inteligencia y funcionalidad al hardware (Sistema Operativo, Aplicaciones de seguridad). Representa el <strong>capital intelectual</strong> y la capacidad de actuar sobre el hardware.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Introducción al Software Libre (SL) y la Soberanía Tecnológica</h4>
                        <p class="mb-3">El SL es un pilar de la <strong>independencia tecnológica</strong> y la seguridad nacional. Al tener acceso y control sobre el código fuente, el Estado garantiza la <strong>transparencia operativa</strong> y reduce la vulnerabilidad ante ataques o espionaje.</p>

                        <h5 class="text-lg font-medium mb-1 mt-3 text-gray-700">Cuatro Libertades y su Implicación</h5>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li><strong>Usar</strong> (sin licencias restrictivas).</li>
                            <li><strong>Estudiar</strong> (entender cómo funciona la herramienta policial).</li>
                            <li><strong>Modificar</strong> (adaptarla a las necesidades específicas de la UNES/PNB).</li>
                            <li><strong>Distribuir</strong> (compartir conocimiento sin costo).</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Autónomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Reflexión Profunda:</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Investigue el Decreto Presidencial N° 3.390. Escriba un párrafo (mínimo 15 líneas) explicando cómo su implementación práctica fortalece la seguridad nacional al garantizar la no dependencia de monopolios extranjeros.</p>
                        <p class="mt-2 font-medium">Ejercicio de Aplicación (Offline):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Dibuje un diagrama de bloques de una computadora e identifique dónde se aplica el Software Libre. Indique qué componente de Hardware es crítico para la <strong>seguridad del dato</strong> y qué elemento de Software es clave para la <strong>seguridad operativa</strong>.</p>
                    `,
                    ai_tool: 'explicador', ai_message: 'Utiliza el Explicador de Conceptos para profundizar en la "Soberanía Tecnológica" o el "Decreto N° 3.390".'
                },
                {
                    id: 'semana-2', title: 'Semana 2: Ofimática Práctica y Creación de Informes',
                    purpose: 'Aplicar herramientas ofimáticas (Microsoft Office o Software Libre) para diseñar documentos, informes y presentaciones policiales claras y estandarizadas, adaptándose a limitaciones técnicas.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">Herramientas para la Información y la Cadena de Custodia Digital</h4>
                        <p class="mb-3">La <strong>Cadena de Custodia Digital</strong> implica asegurar que los archivos (pruebas, informes, testimonios) no sean alterados, lográndose con el manejo de versiones, firmas digitales y el uso de formatos abiertos que garanticen la perdurabilidad del dato.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Diseño de Documentos de Texto y Estandarización</h4>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Uso de estilos y plantillas para estandarizar <strong>Actas Policiales</strong>, minutas y partes de novedades.</li>
                            <li>Inserción y manejo de tablas para la recolección estructurada de datos (testigos, evidencias, tiempos).</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Diseño de Hojas de Cálculo para la Gestión del Cuadrante</h4>
                        <p class="mb-3">Creación de tablas y gráficos para la <strong>visualización de estadísticas delictivas</strong>. Uso de fórmulas básicas (suma, promedio, conteo, porcentajes) para <strong>cuantificar la gestión policial</strong> y medir la eficiencia.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Autónomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Documentación (Offline):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Diseñe la plantilla de un informe de novedades (una página) que incluya: encabezado institucional, campos fijos para fecha/hora/ubicación, una tabla de registro de personal asignado y un campo de "Recomendaciones para el Comandante".</p>
                        <p class="mt-2 font-medium">Ejercicio Estadístico (Offline):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Cree una hoja de cálculo simple con 10 filas de datos simulados de delitos. Calcule la <strong>eficiencia del patrullaje</strong> y cree un gráfico de barras mostrando la distribución de los tipos de delitos.</p>
                    `,
                    ai_tool: 'actas', ai_message: '¡Atención! Utiliza el <strong>Asistente de Actas</strong> para practicar la estandarización de tus informes con base en la normativa legal.'
                },
                {
                    id: 'semana-3', title: 'Semana 3: TICs para la Transformación Social',
                    purpose: 'Analizar el potencial de las TICs como motor de la transformación social y empoderamiento comunitario, contextualizando su uso en la Seguridad Ciudadana.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">TICs y la Democracia Protagónica</h4>
                        <p class="mb-3">Las TICs (hardware, software, redes) son clave para la <strong>Democracia Participativa y Protagónica</strong>, ya que permiten al ciudadano ejercer control sobre la gestión pública y exigen la <strong>rendición de cuentas</strong> (accountability) por parte del funcionario PNB.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Correo Electrónico UNES: La Comunicación Estratégica</h4>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Importancia del correo institucional para la <strong>comunicación vertical y horizontal</strong>.</li>
                            <li>Normas de etiqueta y seguridad: uso de contraseñas fuertes, verificación de remitentes y evitar envío de documentos clasificados sin cifrado.</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Redes Sociales (RRSS) y la Lucha contra la Guerra Informativa</h4>
                        <p class="mb-3">Uso como canal de denuncia segura, difusión de campañas de prevención y fortalecimiento del vínculo comunidad-policía. La lucha contra las <strong>Fake News</strong> y los rumores requiere verificación de fuentes y difusión de la verdad institucional.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Autónomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Análisis Ético (Offline):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Basándose en la Ética Policial, elabore una 'Política de Uso' para el funcionario PNB en redes sociales. Escriba 3 normas de conducta, detallando la consecuencia social de violar cada una.</p>
                        <p class="mt-2 font-medium">Ejercicio de Respuesta y Escalada:</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Reciba un correo electrónico simulado de un líder comunitario reportando una falla de alumbrado. Redacte la respuesta usando estructura formal, <strong>garantizando una atención oportuna</strong> y describiendo los pasos internos para escalar la solicitud.</p>
                    `,
                    ai_tool: 'explicador', ai_message: 'Utiliza el Explicador de Conceptos para definir "Democracia Protagónica" o "Guerra Informativa".'
                },
                {
                    id: 'semana-4', title: 'Semana 4: TICs para la Formación y Contexto Regional',
                    purpose: 'Comprender la Plataforma Moodle y la formación virtual como medios para el desarrollo profesional continuo del PNB, investigando tecnologías de seguridad en el contexto nacional y regional.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">Plataforma Moodle en la UNES y Equidad Educativa</h4>
                        <p class="mb-3">Moodle es el Entorno Virtual de Aprendizaje (EVA). Su <strong>Propósito Bolivariano</strong> es garantizar la <strong>equidad educativa</strong> y el acceso a la formación continua a pesar de limitaciones geográficas, superando la <strong>brecha digital</strong>.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Formación Virtual: Beneficios y Desafíos Estratégicos</h4>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li><strong>Beneficios:</strong> Flexibilidad, actualización constante de contenidos y acceso a expertos remoto.</li>
                            <li><strong>Desafíos:</strong> Brecha digital y la necesidad de desarrollar la <strong>auto-disciplina</strong> y la autogestión del conocimiento.</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Tecnologías en CSC y Cooperación Sur-Sur</h4>
                        <p class="mb-3">Se impulsa la <strong>cooperación Sur-Sur</strong> para compartir experiencias exitosas (países ALBA/CELAC) en tecnologías de seguridad y evitar la dependencia tecnológica del Norte.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Autónomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Investigación (Grupal):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Elija dos países de Latinoamérica con enfoques de seguridad distintos. Identifique una herramienta tecnológica usada en cada uno y prepare un resumen comparativo que incluya: Nombre de la Tecnología, Propósito, Ventaja y una Reflexión sobre su aplicabilidad en Venezuela.</p>
                        <p class="mt-2 font-medium">Ejercicio de Reflexión Profunda:</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Si no pudiera acceder a Moodle, ¿cómo organizaría su estudio autónomo de 2 horas? Describa un plan de estudio que incluya técnicas de memorización y uso de herramientas básicas (radio/teléfono).</p>
                    `,
                    ai_tool: 'explicador', ai_message: 'Utiliza el Explicador de Conceptos para entender a fondo la "Cooperación Sur-Sur" en materia de TICs.'
                },
                {
                    id: 'semana-5', title: 'Semana 5: TICs y la Práctica de Seguridad en Venezuela',
                    purpose: 'Analizar y valorar las políticas y herramientas tecnológicas implementadas por el Estado venezolano (Plan de la Patria) para fortalecer la seguridad ciudadana.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">Lineamientos del Plan de la Patria y TICs</h4>
                        <p class="mb-3">El Plan de la Patria, en su <strong>Objetivo Histórico de Independencia y Soberanía</strong>, impulsa la aplicación de las TICs como herramientas para la defensa integral, la seguridad y la paz nacional, fortaleciendo la capacidad de respuesta.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Centro de Comando, Control y Telecomunicaciones VEN 911</h4>
                        <p class="mb-3">El VEN 911 es el centro neurálgico que articula la coordinación de emergencias y seguridad. Su tecnología permite geolocalizar la emergencia, clasificar la prioridad y despachar el recurso más cercano.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">SIMA y Apps Cuadrantes de Paz: Inteligencia y Territorio</h4>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li><strong>Proyecto SIMA:</strong> Centraliza la data operativa, de ubicación y respuesta. Base para la <strong>inteligencia policial basada en evidencia</strong>.</li>
                            <li><strong>Apps Cuadrantes de Paz:</strong> Herramienta móvil para la vinculación directa con la comunidad y la <strong>respuesta eficaz y territorializada</strong>.</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Autónomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Vinculación Profunda:</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Escoja el Objetivo Histórico del Plan de la Patria más relevante para la Seguridad Ciudadana y describa cómo la operación del VEN 911 (sistemas tecnológicos) contribuye directamente a su cumplimiento. <strong>Justifique su elección.</strong></p>
                        <p class="mt-2 font-medium">Ejercicio de Aplicación (Ficha Técnica):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Complete la Ficha Técnica de la App Cuadrantes de Paz: propósito, 3 funcionalidades principales para el funcionario PNB, y el <strong>impacto que tiene en el fortalecimiento del vínculo Policía Comunal-Poder Popular.</strong></p>
                    `,
                    ai_tool: 'explicador', ai_message: 'Utiliza el Explicador de Conceptos para conocer más sobre el "Proyecto SIMA" o el "Objetivo Histórico de Soberanía" del Plan de la Patria.'
                },
                {
                    id: 'semana-6', title: 'Semana 6: Inteligencia Artificial para la Prevención del Delito',
                    purpose: 'Integrar conocimientos previos y reconocer el potencial de la IA como herramienta estratégica, ética y humanista para la seguridad ciudadana.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">Conceptos Básicos de Inteligencia Artificial (IA)</h4>
                        <p class="mb-3">Sistemas informáticos que imitan la inteligencia humana, capaces de aprender, razonar y tomar decisiones. El <strong>Machine Learning (ML)</strong> es el proceso por el cual aprenden de grandes volúmenes de datos históricos (denuncias, ubicaciones) para refinar sus predicciones.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Casos de Uso Ético y Humanista en Prevención</h4>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li><strong>Análisis Predictivo Estratégico:</strong> Optimización del patrullaje, <strong>no para perfilar ciudadanos</strong>.</li>
                            <li><strong>Detección de Anomalías:</strong> Identificación de comportamientos inusuales para activación de intervención preventiva temprana.</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Discusión Social, Ética y Humanista de la IA</h4>
                        <p class="mb-3">La IA debe ser una <strong>herramienta estratégica de apoyo</strong>, nunca un reemplazo del juicio policial humano. Es fundamental entender el <strong>Riesgo del Sesgo Algorítmico</strong>, donde datos históricos sesgados amplifican la discriminación. El PNB debe ser garante de la transparencia y la equidad.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Autónomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Pensamiento Crítico y Ético:</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Si un sistema de IA predice más delitos por nivel socioeconómico, ¿qué principio humanista se viola? Detalle cómo el sesgo algorítmico socava la justicia social y proponga un mecanismo de supervisión humana.</p>
                        <p class="mt-2 font-medium">Ejercicio de Síntesis (Proyecto Final):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Desarrolle la idea central de su "Solución Tecnológica de Bajo Costo". Especifique: Problema social/seguridad, función de la IA simple (clasificar o predecir), tipo de dato que necesitaría, y la implicación social de la propuesta.</p>
                    `,
                    ai_tool: 'generador_casos', ai_message: '¡Prueba el <strong>Generador de Casos Éticos</strong> para tu ejercicio de Pensamiento Crítico!'
                }
            ];

            const weekNav = document.getElementById('week-nav');
            const weekContentContainer = document.getElementById('week-content-container');
            const currentWeekTitle = document.getElementById('current-week-title');
            const aiAlertContainer = document.getElementById('ai-alert-container');
            const aiAlertMessage = document.getElementById('ai-alert-message');

            const aiModal = document.getElementById('ai-modal');
            const aiToolSelector = document.getElementById('ai-tool-selector');
            const aiInputInterface = document.getElementById('ai-input-interface');
            const aiRunButton = document.getElementById('ai-run-button');
            const aiRunButtonText = document.getElementById('ai-run-button-text');
            const aiLoadingSpinner = document.getElementById('ai-loading-spinner');
            const aiResultArea = document.getElementById('ai-result-area');

            // --- Funciones de Utilidad y UI ---

            function generateWeekHTML(week) {
                return `
                    <div id="${week.id}-card" class="bg-white p-6 rounded-xl card-shadow border-l-4 border-unes-blue">
                        <div class="section-header flex justify-between items-center" data-target="${week.id}-content">
                            <h3 class="text-xl font-bold text-gray-800">${week.title}</h3>
                            <span class="text-xl text-unes-blue">▼</span>
                        </div>
                        <div id="${week.id}-content" class="section-content">
                            <h4 class="text-lg font-semibold mt-4 mb-2 text-unes-accent">Propósito a Lograr:</h4>
                            <p class="text-gray-600 mb-4 italic">${week.purpose}</p>
                            <h4 class="text-lg font-semibold mt-4 mb-2 text-unes-blue">Contenido Ampliado:</h4>
                            <div class="text-gray-700 text-sm leading-relaxed">${week.content}</div>
                        </div>
                    </div>
                `;
            }

            function updateUIForWeek(weekId) {
                const weekData = weeks.find(w => w.id === weekId);

                if (!weekData) return;

                // 1. Actualizar título y contenido principal
                currentWeekTitle.textContent = weekData.title;
                weekContentContainer.innerHTML = generateWeekHTML(weekData);

                // 2. Manejar la alerta de IA para la semana
                aiAlertContainer.classList.add('hidden');
                if (weekData.ai_tool) {
                    aiAlertMessage.innerHTML = weekData.ai_message;
                    aiAlertContainer.classList.remove('hidden');
                }

                // 3. Activar el acordeón de la semana
                const header = document.querySelector(`#${weekId}-card .section-header`);
                const content = document.getElementById(`${weekId}-content`);

                if (header && content) {
                     // Expandir la sección de contenido de la semana
                    content.classList.add('expanded');
                    header.querySelector('span').textContent = '▲';

                    // Agregar listener para colapsar si se vuelve a hacer click (andragógico)
                    header.onclick = function() {
                        content.classList.toggle('expanded');
                        header.querySelector('span').textContent = content.classList.contains('expanded') ? '▲' : '▼';
                    };
                }

                // 4. Establecer el selector de IA al cambiar de semana si corresponde
                if (weekData.ai_tool === 'actas' || weekData.ai_tool === 'generador_casos') {
                    aiToolSelector.value = weekData.ai_tool;
                    updateAIInputInterface();
                } else if (weekData.ai_tool === 'explicador') {
                    aiToolSelector.value = 'explicador';
                    updateAIInputInterface();
                }

                // 5. Actualizar botones de navegación
                document.querySelectorAll('#week-nav button').forEach(btn => {
                    btn.classList.remove('bg-unes-light', 'text-unes-blue', 'font-semibold');
                    btn.classList.add('hover:bg-gray-200', 'text-gray-700');
                });
                const activeBtn = document.querySelector(`#nav-btn-${weekId}`);
                if (activeBtn) {
                    activeBtn.classList.add('bg-unes-light', 'text-unes-blue', 'font-semibold');
                    activeBtn.classList.remove('hover:bg-gray-200', 'text-gray-700');
                }
            }

            // --- Inicialización de Navegación ---
            weeks.forEach(week => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <button id="nav-btn-${week.id}" class="w-full text-left p-3 rounded-lg transition duration-150 text-gray-700 hover:bg-gray-200" data-week="${week.id}">
                        ${week.title}
                    </button>
                `;
                li.querySelector('button').addEventListener('click', (e) => {
                    updateUIForWeek(e.target.getAttribute('data-week'));
                });
                weekNav.appendChild(li);
            });

            // Cargar la primera semana al inicio
            updateUIForWeek(weeks[0].id);


            // --- Lógica de la Herramienta de IA (Gemini API) ---

            const API_URL_BASE = "https://generativelanguage.googleapis.com/v1beta/models/";
            const MODEL_NAME = "gemini-2.5-flash-preview-05-20";

            // Función para manejar la lógica de retries con backoff
            async function fetchWithBackoff(url, options, maxRetries = 5, delay = 1000) {
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (response.ok) {
                            return response;
                        } else if (response.status === 429 || response.status >= 500) {
                            // Demasiadas peticiones o error del servidor, intentamos de nuevo
                            const retryAfter = response.headers.get('Retry-After');
                            const waitTime = retryAfter ? parseInt(retryAfter) * 1000 : delay * (2 ** i);
                            await new Promise(resolve => setTimeout(resolve, waitTime));
                        } else {
                            // Otros errores, no reintentamos
                            throw new Error(`API Error: ${response.status} ${response.statusText}`);
                        }
                    } catch (error) {
                        if (i === maxRetries - 1) throw error;
                        await new Promise(resolve => setTimeout(resolve, delay * (2 ** i)));
                    }
                }
            }


            async function fetchAIResponse(systemPrompt, userQuery) {
                // Si la clave es vacía y no estamos en el entorno de desarrollo, el fetch fallará.
                if (apiKey === "AIzaSyAvHg3T7p875lEIyJS3MVz0MsJUHM070MM" && typeof __initial_auth_token === 'undefined') {
                    aiResultArea.innerHTML = "🚨 **ERROR DE AUTENTICACIÓN (CLAVE API VACÍA)** 🚨<br><br>Para usar el Asistente en un servidor externo (como GitHub), debe reemplazar la línea `const apiKey = \"\";` con su clave personal de Gemini API.";
                    return; 
                }
                
                const url = `${API_URL_BASE}${MODEL_NAME}:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }], // Usar Google Search para grounding
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                    config: {
                         // Fuerza la respuesta en español
                        language: "es"
                    }
                };

                aiLoadingSpinner.classList.remove('hidden');
                aiRunButton.disabled = true;

                try {
                    const response = await fetchWithBackoff(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        let text = candidate.content.parts[0].text;

                        // Extraer fuentes (citations)
                        let sources = [];
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions) {
                            sources = groundingMetadata.groundingAttributions
                                .map(attribution => ({
                                    uri: attribution.web?.uri,
                                    title: attribution.web?.title,
                                }))
                                .filter(source => source.uri && source.title);
                        }

                        // Formatear texto y fuentes
                        let formattedResult = text;
                        if (sources.length > 0) {
                            formattedResult += "\n\n---";
                            formattedResult += "\n**Fuentes de Verificación (Grounding):**";
                            sources.slice(0, 3).forEach((s, index) => {
                                formattedResult += `\n${index + 1}. [${s.title || s.uri}](${s.uri})`;
                            });
                        }

                        aiResultArea.innerHTML = formattedResult.replace(/\n/g, '<br>');

                    } else {
                        aiResultArea.innerHTML = "Error: No se pudo generar una respuesta. Intente con una consulta diferente.";
                        console.error("API response error:", result);
                    }
                } catch (error) {
                    aiResultArea.innerHTML = "Error de conexión o API. Asegúrese de que la clave (si es requerida en su entorno) o el servicio estén disponibles.";
                    console.error("Fetch error:", error);
                } finally {
                    aiLoadingSpinner.classList.add('hidden');
                    aiRunButton.disabled = false; // Habilitar después del intento
                }
            }

            function updateAIInputInterface() {
                const selectedTool = aiToolSelector.value;
                aiInputInterface.innerHTML = '';
                aiRunButton.disabled = true;
                aiResultArea.textContent = 'El resultado de la Inteligencia Artificial aparecerá aquí.';

                if (selectedTool === 'explicador') {
                    aiInputInterface.innerHTML = `
                        <label for="input-explicador" class="block text-sm font-medium text-gray-700 mb-1">Concepto a Explicar (Ej: Software Libre, Brecha Digital, VEN 911):</label>
                        <input type="text" id="input-explicador" placeholder="Escriba el concepto clave..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-unes-blue focus:border-unes-blue">
                    `;
                    aiRunButtonText.textContent = 'Explicar Concepto';
                    aiRunButton.disabled = false;
                } else if (selectedTool === 'actas') {
                    // INTERFAZ DE ACTAS MEJORADA CON CAMPOS CLAVE
                    aiInputInterface.innerHTML = `
                        <div class="mb-4 space-y-3">
                            <div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-2 rounded-lg text-xs">
                                **Normativa Legal Venezolana:** Llene con datos objetivos. No emita juicios de valor.
                            </div>
                            <div>
                                <label for="acta-fecha-hora" class="block text-sm font-medium text-gray-700">1. Fecha y Hora Exacta de la Intervención:</label>
                                <input type="text" id="acta-fecha-hora" placeholder="Ej: 20 de septiembre de 2025, siendo las 14:30 horas..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-unes-blue focus:border-unes-blue">
                            </div>
                            <div>
                                <label for="acta-lugar" class="block text-sm font-medium text-gray-700">2. Lugar Exacto de Ocurrencia / Abordaje:</label>
                                <input type="text" id="acta-lugar" placeholder="Ej: Calle Principal con Avenida Libertador, frente al Nro. 5..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-unes-blue focus:border-unes-blue">
                            </div>
                            <div>
                                <label for="acta-hechos" class="block text-sm font-medium text-gray-700">3. Descripción Objetiva y Detallada de los Hechos (Testimonio Policial):</label>
                                <textarea id="acta-hechos" rows="4" placeholder="Describa solo los hechos observados: quién, qué hizo, cómo y cuándo, sin emitir juicios de valor. Ej: 'Se avistó a ciudadano de franela roja corriendo en dirección sur...'." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-unes-blue focus:border-unes-blue"></textarea>
                            </div>
                        </div>
                    `;
                    aiRunButtonText.textContent = 'Generar Borrador de Acta';
                    aiRunButton.disabled = false;
                } else if (selectedTool === 'generador_casos') {
                    aiInputInterface.innerHTML = `
                        <div class="bg-blue-50 border-l-4 border-unes-blue text-blue-900 p-3 rounded-lg">
                            <p class="font-medium">Tarea Fija: Generar un dilema ético.</p>
                            <p class="text-xs">Este botón generará un caso de estudio ético basado en IA para tu discusión en la Semana 6.</p>
                        </div>
                    `;
                    aiRunButtonText.textContent = 'Generar Caso Ético';
                    aiRunButton.disabled = false;
                } else {
                    aiRunButtonText.textContent = 'Seleccione una herramienta...';
                }
            }

            aiToolSelector.addEventListener('change', updateAIInputInterface);
            document.getElementById('btn-toggle-ia-modal').addEventListener('click', () => {
                aiModal.classList.toggle('hidden');
                updateAIInputInterface();
            });

            aiRunButton.addEventListener('click', async () => {
                const selectedTool = aiToolSelector.value;
                aiResultArea.textContent = 'Cargando respuesta...';

                if (selectedTool === 'explicador') {
                    const concept = document.getElementById('input-explicador').value.trim();
                    if (!concept) {
                        aiResultArea.textContent = 'Por favor, ingrese un concepto para explicar.';
                        return;
                    }
                    const systemPrompt = "Eres un tutor andragógico experto en TICs y seguridad ciudadana. Explica el concepto proporcionado en un lenguaje claro, conciso y orientado a la aplicación práctica para un funcionario policial, ofreciendo un ejemplo real de su uso en el PNB.";
                    await fetchAIResponse(systemPrompt, `Explica el concepto: "${concept}"`);
                } else if (selectedTool === 'actas') {
                    const fechaHora = document.getElementById('acta-fecha-hora').value.trim();
                    const lugar = document.getElementById('acta-lugar').value.trim();
                    const hechos = document.getElementById('acta-hechos').value.trim();

                    if (!fechaHora || !lugar || !hechos) {
                        aiResultArea.textContent = '🚨 Faltan datos clave (Fecha/Hora, Lugar, Hechos) para generar un acta válida. Por favor, complete todos los campos.';
                        return;
                    }

                    // Construcción del prompt de Acta con enfoque en normativa venezolana
                    const userQuery = `
                        Utiliza esta información para redactar el cuerpo de una Acta Policial, cumpliendo estrictamente con la normativa legal venezolana vigente que rige la materia (formalidad, objetividad, cadena de custodia, sin juicios de valor).
                        - FECHA Y HORA: ${fechaHora}
                        - LUGAR: ${lugar}
                        - DESCRIPCIÓN DE LOS HECHOS: ${hechos}
                        El resultado debe ser solo la narración de los hechos de manera continua y profesional, lista para ser insertada en la plantilla formal.
                    `;

                    const systemPrompt = "Actúa como un experto en redacción de Actas Policiales en Venezuela, cumpliendo con los estándares de objetividad, formalidad, y legalidad (COPP). Tu tarea es transformar los datos clave y la descripción de hechos en una narración continua, concisa y profesional, adecuada para el Cuerpo de Policía Nacional Bolivariana (PNB).";
                    await fetchAIResponse(systemPrompt, userQuery);

                } else if (selectedTool === 'generador_casos') {
                    const systemPrompt = "Genera un escenario de caso práctico (máximo 150 palabras) para un ejercicio de pensamiento crítico. El caso debe involucrar el uso de Machine Learning o análisis predictivo en un Cuadrante de Paz y plantear un dilema ético relacionado con el sesgo algorítmico o la violación de un principio humanista. El caso debe ser realista para el contexto PNB/UNES.";
                    await fetchAIResponse(systemPrompt, "Genera un caso de uso ético sobre IA en el Cuadrante de Paz.");
                }
            });

            // Inicializar la interfaz de IA en el modal
            updateAIInputInterface();

        });
    </script>
</body>
</html>
