<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GU√çA INTEGRAL: TICS y Soberan√≠a Tecnol√≥gica (PNB-UNES)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuraci√≥n de Fuentes y Colores (Estilo UNES/Seguridad) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'unes-blue': '#1e40af', // Tonalidad de azul oscuro para √©nfasis
                        'unes-light': '#bfdbfe', // Azul claro para fondos
                        'unes-accent': '#f59e0b', // Naranja/√Åmbar para acentos de alerta/IA
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilos Andrag√≥gicos y de Accesibilidad */
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .section-header {
            cursor: pointer;
            transition: background-color 0.3s;
            border-radius: 0.5rem;
        }
        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
        }
        .section-content.expanded {
            max-height: 5000px; /* Suficientemente grande para todo el contenido */
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        .loading-spinner {
            border-top-color: transparent;
            border-left-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <!-- üö® IMPORTANTE: CONFIGURACI√ìN DE LA CLAVE API üö® -->
    <!-- 
        Si est√° ejecutando este archivo fuera del entorno de desarrollo (ej: en GitHub Pages),
        DEBE obtener su propia clave de API de Gemini y colocarla aqu√≠.
        De lo contrario, obtendr√° un error de "conexi√≥n" o "autenticaci√≥n".
        
        EJEMPLO: const apiKey = "AQUI_VA_TU_CLAVE_PERSONAL_DE_GEMINI";
        
        Dejamos la cadena vac√≠a para que funcione en el entorno actual de desarrollo.
    -->
    <script>const apiKey = "AIzaSyAvHg3T7p875lEIyJS3MVz0MsJUHM070MM";</script>

    <!-- Header Fijo y T√≠tulo Principal (Z-INDEX: 50) -->
    <header class="bg-unes-blue text-white shadow-lg p-4 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl sm:text-2xl font-extrabold tracking-tight">
                Gu√≠a Integral: TICs y Soberan√≠a Tecnol√≥gica
            </h1>
            <button id="btn-toggle-ia-modal" class="bg-unes-accent hover:bg-yellow-600 text-unes-blue font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-md">
                <span class="sm:inline hidden">Asistente IA</span>
                <span class="sm:hidden inline">ü§ñ</span>
            </button>
        </div>
    </header>

    <!-- Contenido Principal (Main Layout) -->
    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 flex flex-col lg:flex-row gap-8">

        <!-- Panel de Navegaci√≥n (Semanas) (Z-INDEX: 40) -->
        <nav class="lg:w-1/4 w-full bg-white p-4 rounded-xl shadow-lg h-fit sticky top-20 z-40">
            <h2 class="text-lg font-bold text-unes-blue mb-4 border-b pb-2">Plan de Estudio (6 Semanas)</h2>
            <ul id="week-nav" class="space-y-2">
                <!-- Botones de Semanas generados por JS -->
            </ul>
        </nav>

        <!-- √Årea de Contenido de la Gu√≠a -->
        <section id="content-area" class="lg:w-3/4 w-full">
            <h2 id="current-week-title" class="text-3xl font-extrabold text-gray-800 mb-6">Seleccione una Semana</h2>

            <!-- Contenedor para la Alerta de IA -->
            <div id="ai-alert-container" class="mb-6 hidden">
                <div class="bg-unes-accent border-l-4 border-yellow-700 text-gray-900 p-4 rounded-lg" role="alert">
                    <p class="font-bold">Herramienta de IA Disponible:</p>
                    <p class="text-sm" id="ai-alert-message"></p>
                    <button onclick="document.getElementById('btn-toggle-ia-modal').click()" class="mt-2 text-xs font-semibold underline hover:text-unes-blue">
                        Abrir Asistente
                    </button>
                </div>
            </div>

            <div id="week-content-container" class="space-y-8">
                <!-- El contenido detallado de la semana se insertar√° aqu√≠ por JS -->
            </div>
        </section>
    </main>

    <!-- Modal del Asistente de Inteligencia Artificial (AI) (Z-INDEX: 50) -->
    <div id="ai-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl card-shadow w-full max-w-lg p-6">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-2xl font-bold text-unes-blue">ü§ñ Asistente de IA TICs PNB</h3>
                    <button onclick="document.getElementById('ai-modal').classList.add('hidden')" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
                </div>

                <!-- Selector de Herramienta -->
                <div class="mb-4">
                    <label for="ai-tool-selector" class="block text-sm font-medium text-gray-700 mb-1">Selecciona la Herramienta:</label>
                    <select id="ai-tool-selector" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-unes-blue focus:border-unes-blue">
                        <option value="explicador">Explicador de Conceptos (Todas las Semanas)</option>
                        <option value="actas">Asistente de Actas (Semana 2)</option>
                        <option value="generador_casos">Generador de Casos √âticos (Semana 6)</option>
                    </select>
                </div>

                <!-- Interfaz de Input (Din√°mica) -->
                <div id="ai-input-interface">
                    <!-- Contenido de input din√°mico -->
                </div>

                <!-- Bot√≥n y Spinner de Carga -->
                <div class="flex items-center space-x-4 mt-4">
                    <button id="ai-run-button" class="flex-1 bg-unes-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex justify-center items-center" disabled>
                        <span id="ai-run-button-text">Seleccione una herramienta...</span>
                        <div id="ai-loading-spinner" class="w-4 h-4 border-2 border-white rounded-full loading-spinner ml-2 hidden"></div>
                    </button>
                </div>

                <!-- √Årea de Resultados -->
                <div class="mt-6 border-t pt-4">
                    <h4 class="text-md font-bold text-gray-800 mb-2">Resultado de la IA:</h4>
                    <div id="ai-result-area" class="bg-gray-50 p-4 rounded-lg text-sm text-gray-700 border border-gray-200 min-h-[100px] whitespace-pre-wrap">
                        El resultado de la Inteligencia Artificial aparecer√° aqu√≠.
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Script de Navegaci√≥n y L√≥gica de IA -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const weeks = [
                {
                    id: 'semana-1', title: 'Semana 1: Soberan√≠a Tecnol√≥gica y PC',
                    purpose: 'Comprender la computadora como herramienta esencial para el servicio policial y diferenciar el Hardware del Software bajo una √≥ptica de soberan√≠a tecnol√≥gica.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">La Computadora como Sistema B√°sico de Gesti√≥n y Respuesta</h4>
                        <p class="mb-3">M√°s que una m√°quina, es un conjunto de componentes interconectados que procesan informaci√≥n cr√≠tica, desde datos ciudadanos hasta patrones delictivos, generando resultados √∫tiles para la seguridad y la ciudadan√≠a.</p>

                        <h5 class="text-lg font-medium mb-1 mt-3 text-gray-700">Hardware (Lo tangible)</h5>
                        <p class="mb-3">Componentes f√≠sicos esenciales para el procesamiento de la informaci√≥n (CPU, Memoria RAM, Almacenamiento, Perif√©ricos E/S). Su gesti√≥n y mantenimiento son vitales para la operatividad del Estado.</p>

                        <h5 class="text-lg font-medium mb-1 mt-3 text-gray-700">Software (Lo intangible)</h5>
                        <p class="mb-3">Programas e instrucciones que dotan de inteligencia y funcionalidad al hardware (Sistema Operativo, Aplicaciones de seguridad). Representa el <strong>capital intelectual</strong> y la capacidad de actuar sobre el hardware.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Introducci√≥n al Software Libre (SL) y la Soberan√≠a Tecnol√≥gica</h4>
                        <p class="mb-3">El SL es un pilar de la <strong>independencia tecnol√≥gica</strong> y la seguridad nacional. Al tener acceso y control sobre el c√≥digo fuente, el Estado garantiza la <strong>transparencia operativa</strong> y reduce la vulnerabilidad ante ataques o espionaje.</p>

                        <h5 class="text-lg font-medium mb-1 mt-3 text-gray-700">Cuatro Libertades y su Implicaci√≥n</h5>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li><strong>Usar</strong> (sin licencias restrictivas).</li>
                            <li><strong>Estudiar</strong> (entender c√≥mo funciona la herramienta policial).</li>
                            <li><strong>Modificar</strong> (adaptarla a las necesidades espec√≠ficas de la UNES/PNB).</li>
                            <li><strong>Distribuir</strong> (compartir conocimiento sin costo).</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Aut√≥nomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Reflexi√≥n Profunda:</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Investigue el Decreto Presidencial N¬∞ 3.390. Escriba un p√°rrafo (m√≠nimo 15 l√≠neas) explicando c√≥mo su implementaci√≥n pr√°ctica fortalece la seguridad nacional al garantizar la no dependencia de monopolios extranjeros.</p>
                        <p class="mt-2 font-medium">Ejercicio de Aplicaci√≥n (Offline):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Dibuje un diagrama de bloques de una computadora e identifique d√≥nde se aplica el Software Libre. Indique qu√© componente de Hardware es cr√≠tico para la <strong>seguridad del dato</strong> y qu√© elemento de Software es clave para la <strong>seguridad operativa</strong>.</p>
                    `,
                    ai_tool: 'explicador', ai_message: 'Utiliza el Explicador de Conceptos para profundizar en la "Soberan√≠a Tecnol√≥gica" o el "Decreto N¬∞ 3.390".'
                },
                {
                    id: 'semana-2', title: 'Semana 2: Ofim√°tica Pr√°ctica y Creaci√≥n de Informes',
                    purpose: 'Aplicar herramientas ofim√°ticas (Microsoft Office o Software Libre) para dise√±ar documentos, informes y presentaciones policiales claras y estandarizadas, adapt√°ndose a limitaciones t√©cnicas.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">Herramientas para la Informaci√≥n y la Cadena de Custodia Digital</h4>
                        <p class="mb-3">La <strong>Cadena de Custodia Digital</strong> implica asegurar que los archivos (pruebas, informes, testimonios) no sean alterados, logr√°ndose con el manejo de versiones, firmas digitales y el uso de formatos abiertos que garanticen la perdurabilidad del dato.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Dise√±o de Documentos de Texto y Estandarizaci√≥n</h4>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Uso de estilos y plantillas para estandarizar <strong>Actas Policiales</strong>, minutas y partes de novedades.</li>
                            <li>Inserci√≥n y manejo de tablas para la recolecci√≥n estructurada de datos (testigos, evidencias, tiempos).</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Dise√±o de Hojas de C√°lculo para la Gesti√≥n del Cuadrante</h4>
                        <p class="mb-3">Creaci√≥n de tablas y gr√°ficos para la <strong>visualizaci√≥n de estad√≠sticas delictivas</strong>. Uso de f√≥rmulas b√°sicas (suma, promedio, conteo, porcentajes) para <strong>cuantificar la gesti√≥n policial</strong> y medir la eficiencia.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Aut√≥nomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Documentaci√≥n (Offline):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Dise√±e la plantilla de un informe de novedades (una p√°gina) que incluya: encabezado institucional, campos fijos para fecha/hora/ubicaci√≥n, una tabla de registro de personal asignado y un campo de "Recomendaciones para el Comandante".</p>
                        <p class="mt-2 font-medium">Ejercicio Estad√≠stico (Offline):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Cree una hoja de c√°lculo simple con 10 filas de datos simulados de delitos. Calcule la <strong>eficiencia del patrullaje</strong> y cree un gr√°fico de barras mostrando la distribuci√≥n de los tipos de delitos.</p>
                    `,
                    ai_tool: 'actas', ai_message: '¬°Atenci√≥n! Utiliza el <strong>Asistente de Actas</strong> para practicar la estandarizaci√≥n de tus informes con base en la normativa legal.'
                },
                {
                    id: 'semana-3', title: 'Semana 3: TICs para la Transformaci√≥n Social',
                    purpose: 'Analizar el potencial de las TICs como motor de la transformaci√≥n social y empoderamiento comunitario, contextualizando su uso en la Seguridad Ciudadana.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">TICs y la Democracia Protag√≥nica</h4>
                        <p class="mb-3">Las TICs (hardware, software, redes) son clave para la <strong>Democracia Participativa y Protag√≥nica</strong>, ya que permiten al ciudadano ejercer control sobre la gesti√≥n p√∫blica y exigen la <strong>rendici√≥n de cuentas</strong> (accountability) por parte del funcionario PNB.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Correo Electr√≥nico UNES: La Comunicaci√≥n Estrat√©gica</h4>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li>Importancia del correo institucional para la <strong>comunicaci√≥n vertical y horizontal</strong>.</li>
                            <li>Normas de etiqueta y seguridad: uso de contrase√±as fuertes, verificaci√≥n de remitentes y evitar env√≠o de documentos clasificados sin cifrado.</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Redes Sociales (RRSS) y la Lucha contra la Guerra Informativa</h4>
                        <p class="mb-3">Uso como canal de denuncia segura, difusi√≥n de campa√±as de prevenci√≥n y fortalecimiento del v√≠nculo comunidad-polic√≠a. La lucha contra las <strong>Fake News</strong> y los rumores requiere verificaci√≥n de fuentes y difusi√≥n de la verdad institucional.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Aut√≥nomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de An√°lisis √âtico (Offline):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Bas√°ndose en la √âtica Policial, elabore una 'Pol√≠tica de Uso' para el funcionario PNB en redes sociales. Escriba 3 normas de conducta, detallando la consecuencia social de violar cada una.</p>
                        <p class="mt-2 font-medium">Ejercicio de Respuesta y Escalada:</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Reciba un correo electr√≥nico simulado de un l√≠der comunitario reportando una falla de alumbrado. Redacte la respuesta usando estructura formal, <strong>garantizando una atenci√≥n oportuna</strong> y describiendo los pasos internos para escalar la solicitud.</p>
                    `,
                    ai_tool: 'explicador', ai_message: 'Utiliza el Explicador de Conceptos para definir "Democracia Protag√≥nica" o "Guerra Informativa".'
                },
                {
                    id: 'semana-4', title: 'Semana 4: TICs para la Formaci√≥n y Contexto Regional',
                    purpose: 'Comprender la Plataforma Moodle y la formaci√≥n virtual como medios para el desarrollo profesional continuo del PNB, investigando tecnolog√≠as de seguridad en el contexto nacional y regional.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">Plataforma Moodle en la UNES y Equidad Educativa</h4>
                        <p class="mb-3">Moodle es el Entorno Virtual de Aprendizaje (EVA). Su <strong>Prop√≥sito Bolivariano</strong> es garantizar la <strong>equidad educativa</strong> y el acceso a la formaci√≥n continua a pesar de limitaciones geogr√°ficas, superando la <strong>brecha digital</strong>.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Formaci√≥n Virtual: Beneficios y Desaf√≠os Estrat√©gicos</h4>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li><strong>Beneficios:</strong> Flexibilidad, actualizaci√≥n constante de contenidos y acceso a expertos remoto.</li>
                            <li><strong>Desaf√≠os:</strong> Brecha digital y la necesidad de desarrollar la <strong>auto-disciplina</strong> y la autogesti√≥n del conocimiento.</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Tecnolog√≠as en CSC y Cooperaci√≥n Sur-Sur</h4>
                        <p class="mb-3">Se impulsa la <strong>cooperaci√≥n Sur-Sur</strong> para compartir experiencias exitosas (pa√≠ses ALBA/CELAC) en tecnolog√≠as de seguridad y evitar la dependencia tecnol√≥gica del Norte.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Aut√≥nomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Investigaci√≥n (Grupal):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Elija dos pa√≠ses de Latinoam√©rica con enfoques de seguridad distintos. Identifique una herramienta tecnol√≥gica usada en cada uno y prepare un resumen comparativo que incluya: Nombre de la Tecnolog√≠a, Prop√≥sito, Ventaja y una Reflexi√≥n sobre su aplicabilidad en Venezuela.</p>
                        <p class="mt-2 font-medium">Ejercicio de Reflexi√≥n Profunda:</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Si no pudiera acceder a Moodle, ¬øc√≥mo organizar√≠a su estudio aut√≥nomo de 2 horas? Describa un plan de estudio que incluya t√©cnicas de memorizaci√≥n y uso de herramientas b√°sicas (radio/tel√©fono).</p>
                    `,
                    ai_tool: 'explicador', ai_message: 'Utiliza el Explicador de Conceptos para entender a fondo la "Cooperaci√≥n Sur-Sur" en materia de TICs.'
                },
                {
                    id: 'semana-5', title: 'Semana 5: TICs y la Pr√°ctica de Seguridad en Venezuela',
                    purpose: 'Analizar y valorar las pol√≠ticas y herramientas tecnol√≥gicas implementadas por el Estado venezolano (Plan de la Patria) para fortalecer la seguridad ciudadana.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">Lineamientos del Plan de la Patria y TICs</h4>
                        <p class="mb-3">El Plan de la Patria, en su <strong>Objetivo Hist√≥rico de Independencia y Soberan√≠a</strong>, impulsa la aplicaci√≥n de las TICs como herramientas para la defensa integral, la seguridad y la paz nacional, fortaleciendo la capacidad de respuesta.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Centro de Comando, Control y Telecomunicaciones VEN 911</h4>
                        <p class="mb-3">El VEN 911 es el centro neur√°lgico que articula la coordinaci√≥n de emergencias y seguridad. Su tecnolog√≠a permite geolocalizar la emergencia, clasificar la prioridad y despachar el recurso m√°s cercano.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">SIMA y Apps Cuadrantes de Paz: Inteligencia y Territorio</h4>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li><strong>Proyecto SIMA:</strong> Centraliza la data operativa, de ubicaci√≥n y respuesta. Base para la <strong>inteligencia policial basada en evidencia</strong>.</li>
                            <li><strong>Apps Cuadrantes de Paz:</strong> Herramienta m√≥vil para la vinculaci√≥n directa con la comunidad y la <strong>respuesta eficaz y territorializada</strong>.</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Aut√≥nomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Vinculaci√≥n Profunda:</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Escoja el Objetivo Hist√≥rico del Plan de la Patria m√°s relevante para la Seguridad Ciudadana y describa c√≥mo la operaci√≥n del VEN 911 (sistemas tecnol√≥gicos) contribuye directamente a su cumplimiento. <strong>Justifique su elecci√≥n.</strong></p>
                        <p class="mt-2 font-medium">Ejercicio de Aplicaci√≥n (Ficha T√©cnica):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Complete la Ficha T√©cnica de la App Cuadrantes de Paz: prop√≥sito, 3 funcionalidades principales para el funcionario PNB, y el <strong>impacto que tiene en el fortalecimiento del v√≠nculo Polic√≠a Comunal-Poder Popular.</strong></p>
                    `,
                    ai_tool: 'explicador', ai_message: 'Utiliza el Explicador de Conceptos para conocer m√°s sobre el "Proyecto SIMA" o el "Objetivo Hist√≥rico de Soberan√≠a" del Plan de la Patria.'
                },
                {
                    id: 'semana-6', title: 'Semana 6: Inteligencia Artificial para la Prevenci√≥n del Delito',
                    purpose: 'Integrar conocimientos previos y reconocer el potencial de la IA como herramienta estrat√©gica, √©tica y humanista para la seguridad ciudadana.',
                    content: `
                        <h4 class="text-xl font-semibold mb-2 text-unes-blue">Conceptos B√°sicos de Inteligencia Artificial (IA)</h4>
                        <p class="mb-3">Sistemas inform√°ticos que imitan la inteligencia humana, capaces de aprender, razonar y tomar decisiones. El <strong>Machine Learning (ML)</strong> es el proceso por el cual aprenden de grandes vol√∫menes de datos hist√≥ricos (denuncias, ubicaciones) para refinar sus predicciones.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Casos de Uso √âtico y Humanista en Prevenci√≥n</h4>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li><strong>An√°lisis Predictivo Estrat√©gico:</strong> Optimizaci√≥n del patrullaje, <strong>no para perfilar ciudadanos</strong>.</li>
                            <li><strong>Detecci√≥n de Anomal√≠as:</strong> Identificaci√≥n de comportamientos inusuales para activaci√≥n de intervenci√≥n preventiva temprana.</li>
                        </ul>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Discusi√≥n Social, √âtica y Humanista de la IA</h4>
                        <p class="mb-3">La IA debe ser una <strong>herramienta estrat√©gica de apoyo</strong>, nunca un reemplazo del juicio policial humano. Es fundamental entender el <strong>Riesgo del Sesgo Algor√≠tmico</strong>, donde datos hist√≥ricos sesgados amplifican la discriminaci√≥n. El PNB debe ser garante de la transparencia y la equidad.</p>

                        <h4 class="text-xl font-semibold mb-2 text-unes-blue mt-5">Ejercicios (Aut√≥nomo en Casa)</h4>
                        <p class="mb-2 font-medium">Ejercicio de Pensamiento Cr√≠tico y √âtico:</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Si un sistema de IA predice m√°s delitos por nivel socioecon√≥mico, ¬øqu√© principio humanista se viola? Detalle c√≥mo el sesgo algor√≠tmico socava la justicia social y proponga un mecanismo de supervisi√≥n humana.</p>
                        <p class="mt-2 font-medium">Ejercicio de S√≠ntesis (Proyecto Final):</p>
                        <p class="text-sm border-l-4 border-unes-accent pl-3 italic">Desarrolle la idea central de su "Soluci√≥n Tecnol√≥gica de Bajo Costo". Especifique: Problema social/seguridad, funci√≥n de la IA simple (clasificar o predecir), tipo de dato que necesitar√≠a, y la implicaci√≥n social de la propuesta.</p>
                    `,
                    ai_tool: 'generador_casos', ai_message: '¬°Prueba el <strong>Generador de Casos √âticos</strong> para tu ejercicio de Pensamiento Cr√≠tico!'
                }
            ];

            const weekNav = document.getElementById('week-nav');
            const weekContentContainer = document.getElementById('week-content-container');
            const currentWeekTitle = document.getElementById('current-week-title');
            const aiAlertContainer = document.getElementById('ai-alert-container');
            const aiAlertMessage = document.getElementById('ai-alert-message');

            const aiModal = document.getElementById('ai-modal');
            const aiToolSelector = document.getElementById('ai-tool-selector');
            const aiInputInterface = document.getElementById('ai-input-interface');
            const aiRunButton = document.getElementById('ai-run-button');
            const aiRunButtonText = document.getElementById('ai-run-button-text');
            const aiLoadingSpinner = document.getElementById('ai-loading-spinner');
            const aiResultArea = document.getElementById('ai-result-area');

            // --- Funciones de Utilidad y UI ---

            function generateWeekHTML(week) {
                return `
                    <div id="${week.id}-card" class="bg-white p-6 rounded-xl card-shadow border-l-4 border-unes-blue">
                        <div class="section-header flex justify-between items-center" data-target="${week.id}-content">
                            <h3 class="text-xl font-bold text-gray-800">${week.title}</h3>
                            <span class="text-xl text-unes-blue">‚ñº</span>
                        </div>
                        <div id="${week.id}-content" class="section-content">
                            <h4 class="text-lg font-semibold mt-4 mb-2 text-unes-accent">Prop√≥sito a Lograr:</h4>
                            <p class="text-gray-600 mb-4 italic">${week.purpose}</p>
                            <h4 class="text-lg font-semibold mt-4 mb-2 text-unes-blue">Contenido Ampliado:</h4>
                            <div class="text-gray-700 text-sm leading-relaxed">${week.content}</div>
                        </div>
                    </div>
                `;
            }

            function updateUIForWeek(weekId) {
                const weekData = weeks.find(w => w.id === weekId);

                if (!weekData) return;

                // 1. Actualizar t√≠tulo y contenido principal
                currentWeekTitle.textContent = weekData.title;
                weekContentContainer.innerHTML = generateWeekHTML(weekData);

                // 2. Manejar la alerta de IA para la semana
                aiAlertContainer.classList.add('hidden');
                if (weekData.ai_tool) {
                    aiAlertMessage.innerHTML = weekData.ai_message;
                    aiAlertContainer.classList.remove('hidden');
                }

                // 3. Activar el acorde√≥n de la semana
                const header = document.querySelector(`#${weekId}-card .section-header`);
                const content = document.getElementById(`${weekId}-content`);

                if (header && content) {
                     // Expandir la secci√≥n de contenido de la semana
                    content.classList.add('expanded');
                    header.querySelector('span').textContent = '‚ñ≤';

                    // Agregar listener para colapsar si se vuelve a hacer click (andrag√≥gico)
                    header.onclick = function() {
                        content.classList.toggle('expanded');
                        header.querySelector('span').textContent = content.classList.contains('expanded') ? '‚ñ≤' : '‚ñº';
                    };
                }

                // 4. Establecer el selector de IA al cambiar de semana si corresponde
                if (weekData.ai_tool === 'actas' || weekData.ai_tool === 'generador_casos') {
                    aiToolSelector.value = weekData.ai_tool;
                    updateAIInputInterface();
                } else if (weekData.ai_tool === 'explicador') {
                    aiToolSelector.value = 'explicador';
                    updateAIInputInterface();
                }

                // 5. Actualizar botones de navegaci√≥n
                document.querySelectorAll('#week-nav button').forEach(btn => {
                    btn.classList.remove('bg-unes-light', 'text-unes-blue', 'font-semibold');
                    btn.classList.add('hover:bg-gray-200', 'text-gray-700');
                });
                const activeBtn = document.querySelector(`#nav-btn-${weekId}`);
                if (activeBtn) {
                    activeBtn.classList.add('bg-unes-light', 'text-unes-blue', 'font-semibold');
                    activeBtn.classList.remove('hover:bg-gray-200', 'text-gray-700');
                }
            }

            // --- Inicializaci√≥n de Navegaci√≥n ---
            weeks.forEach(week => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <button id="nav-btn-${week.id}" class="w-full text-left p-3 rounded-lg transition duration-150 text-gray-700 hover:bg-gray-200" data-week="${week.id}">
                        ${week.title}
                    </button>
                `;
                li.querySelector('button').addEventListener('click', (e) => {
                    updateUIForWeek(e.target.getAttribute('data-week'));
                });
                weekNav.appendChild(li);
            });

            // Cargar la primera semana al inicio
            updateUIForWeek(weeks[0].id);


            // --- L√≥gica de la Herramienta de IA (Gemini API) ---

            const API_URL_BASE = "https://generativelanguage.googleapis.com/v1beta/models/";
            const MODEL_NAME = "gemini-2.5-flash-preview-05-20";

            // Funci√≥n para manejar la l√≥gica de retries con backoff
            async function fetchWithBackoff(url, options, maxRetries = 5, delay = 1000) {
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (response.ok) {
                            return response;
                        } else if (response.status === 429 || response.status >= 500) {
                            // Demasiadas peticiones o error del servidor, intentamos de nuevo
                            const retryAfter = response.headers.get('Retry-After');
                            const waitTime = retryAfter ? parseInt(retryAfter) * 1000 : delay * (2 ** i);
                            await new Promise(resolve => setTimeout(resolve, waitTime));
                        } else {
                            // Otros errores, no reintentamos
                            throw new Error(`API Error: ${response.status} ${response.statusText}`);
                        }
                    } catch (error) {
                        if (i === maxRetries - 1) throw error;
                        await new Promise(resolve => setTimeout(resolve, delay * (2 ** i)));
                    }
                }
            }


            async function fetchAIResponse(systemPrompt, userQuery) {
                // Si la clave es vac√≠a y no estamos en el entorno de desarrollo, el fetch fallar√°.
                if (apiKey === "AIzaSyAvHg3T7p875lEIyJS3MVz0MsJUHM070MM" && typeof __initial_auth_token === 'undefined') {
                    aiResultArea.innerHTML = "üö® **ERROR DE AUTENTICACI√ìN (CLAVE API VAC√çA)** üö®<br><br>Para usar el Asistente en un servidor externo (como GitHub), debe reemplazar la l√≠nea `const apiKey = \"\";` con su clave personal de Gemini API.";
                    return; 
                }
                
                const url = `${API_URL_BASE}${MODEL_NAME}:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }], // Usar Google Search para grounding
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                    config: {
                         // Fuerza la respuesta en espa√±ol
                        language: "es"
                    }
                };

                aiLoadingSpinner.classList.remove('hidden');
                aiRunButton.disabled = true;

                try {
                    const response = await fetchWithBackoff(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        let text = candidate.content.parts[0].text;

                        // Extraer fuentes (citations)
                        let sources = [];
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions) {
                            sources = groundingMetadata.groundingAttributions
                                .map(attribution => ({
                                    uri: attribution.web?.uri,
                                    title: attribution.web?.title,
                                }))
                                .filter(source => source.uri && source.title);
                        }

                        // Formatear texto y fuentes
                        let formattedResult = text;
                        if (sources.length > 0) {
                            formattedResult += "\n\n---";
                            formattedResult += "\n**Fuentes de Verificaci√≥n (Grounding):**";
                            sources.slice(0, 3).forEach((s, index) => {
                                formattedResult += `\n${index + 1}. [${s.title || s.uri}](${s.uri})`;
                            });
                        }

                        aiResultArea.innerHTML = formattedResult.replace(/\n/g, '<br>');

                    } else {
                        aiResultArea.innerHTML = "Error: No se pudo generar una respuesta. Intente con una consulta diferente.";
                        console.error("API response error:", result);
                    }
                } catch (error) {
                    aiResultArea.innerHTML = "Error de conexi√≥n o API. Aseg√∫rese de que la clave (si es requerida en su entorno) o el servicio est√©n disponibles.";
                    console.error("Fetch error:", error);
                } finally {
                    aiLoadingSpinner.classList.add('hidden');
                    aiRunButton.disabled = false; // Habilitar despu√©s del intento
                }
            }

            function updateAIInputInterface() {
                const selectedTool = aiToolSelector.value;
                aiInputInterface.innerHTML = '';
                aiRunButton.disabled = true;
                aiResultArea.textContent = 'El resultado de la Inteligencia Artificial aparecer√° aqu√≠.';

                if (selectedTool === 'explicador') {
                    aiInputInterface.innerHTML = `
                        <label for="input-explicador" class="block text-sm font-medium text-gray-700 mb-1">Concepto a Explicar (Ej: Software Libre, Brecha Digital, VEN 911):</label>
                        <input type="text" id="input-explicador" placeholder="Escriba el concepto clave..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-unes-blue focus:border-unes-blue">
                    `;
                    aiRunButtonText.textContent = 'Explicar Concepto';
                    aiRunButton.disabled = false;
                } else if (selectedTool === 'actas') {
                    // INTERFAZ DE ACTAS MEJORADA CON CAMPOS CLAVE
                    aiInputInterface.innerHTML = `
                        <div class="mb-4 space-y-3">
                            <div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-2 rounded-lg text-xs">
                                **Normativa Legal Venezolana:** Llene con datos objetivos. No emita juicios de valor.
                            </div>
                            <div>
                                <label for="acta-fecha-hora" class="block text-sm font-medium text-gray-700">1. Fecha y Hora Exacta de la Intervenci√≥n:</label>
                                <input type="text" id="acta-fecha-hora" placeholder="Ej: 20 de septiembre de 2025, siendo las 14:30 horas..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-unes-blue focus:border-unes-blue">
                            </div>
                            <div>
                                <label for="acta-lugar" class="block text-sm font-medium text-gray-700">2. Lugar Exacto de Ocurrencia / Abordaje:</label>
                                <input type="text" id="acta-lugar" placeholder="Ej: Calle Principal con Avenida Libertador, frente al Nro. 5..." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-unes-blue focus:border-unes-blue">
                            </div>
                            <div>
                                <label for="acta-hechos" class="block text-sm font-medium text-gray-700">3. Descripci√≥n Objetiva y Detallada de los Hechos (Testimonio Policial):</label>
                                <textarea id="acta-hechos" rows="4" placeholder="Describa solo los hechos observados: qui√©n, qu√© hizo, c√≥mo y cu√°ndo, sin emitir juicios de valor. Ej: 'Se avist√≥ a ciudadano de franela roja corriendo en direcci√≥n sur...'." class="w-full p-2 border border-gray-300 rounded-lg focus:ring-unes-blue focus:border-unes-blue"></textarea>
                            </div>
                        </div>
                    `;
                    aiRunButtonText.textContent = 'Generar Borrador de Acta';
                    aiRunButton.disabled = false;
                } else if (selectedTool === 'generador_casos') {
                    aiInputInterface.innerHTML = `
                        <div class="bg-blue-50 border-l-4 border-unes-blue text-blue-900 p-3 rounded-lg">
                            <p class="font-medium">Tarea Fija: Generar un dilema √©tico.</p>
                            <p class="text-xs">Este bot√≥n generar√° un caso de estudio √©tico basado en IA para tu discusi√≥n en la Semana 6.</p>
                        </div>
                    `;
                    aiRunButtonText.textContent = 'Generar Caso √âtico';
                    aiRunButton.disabled = false;
                } else {
                    aiRunButtonText.textContent = 'Seleccione una herramienta...';
                }
            }

            aiToolSelector.addEventListener('change', updateAIInputInterface);
            document.getElementById('btn-toggle-ia-modal').addEventListener('click', () => {
                aiModal.classList.toggle('hidden');
                updateAIInputInterface();
            });

            aiRunButton.addEventListener('click', async () => {
                const selectedTool = aiToolSelector.value;
                aiResultArea.textContent = 'Cargando respuesta...';

                if (selectedTool === 'explicador') {
                    const concept = document.getElementById('input-explicador').value.trim();
                    if (!concept) {
                        aiResultArea.textContent = 'Por favor, ingrese un concepto para explicar.';
                        return;
                    }
                    const systemPrompt = "Eres un tutor andrag√≥gico experto en TICs y seguridad ciudadana. Explica el concepto proporcionado en un lenguaje claro, conciso y orientado a la aplicaci√≥n pr√°ctica para un funcionario policial, ofreciendo un ejemplo real de su uso en el PNB.";
                    await fetchAIResponse(systemPrompt, `Explica el concepto: "${concept}"`);
                } else if (selectedTool === 'actas') {
                    const fechaHora = document.getElementById('acta-fecha-hora').value.trim();
                    const lugar = document.getElementById('acta-lugar').value.trim();
                    const hechos = document.getElementById('acta-hechos').value.trim();

                    if (!fechaHora || !lugar || !hechos) {
                        aiResultArea.textContent = 'üö® Faltan datos clave (Fecha/Hora, Lugar, Hechos) para generar un acta v√°lida. Por favor, complete todos los campos.';
                        return;
                    }

                    // Construcci√≥n del prompt de Acta con enfoque en normativa venezolana
                    const userQuery = `
                        Utiliza esta informaci√≥n para redactar el cuerpo de una Acta Policial, cumpliendo estrictamente con la normativa legal venezolana vigente que rige la materia (formalidad, objetividad, cadena de custodia, sin juicios de valor).
                        - FECHA Y HORA: ${fechaHora}
                        - LUGAR: ${lugar}
                        - DESCRIPCI√ìN DE LOS HECHOS: ${hechos}
                        El resultado debe ser solo la narraci√≥n de los hechos de manera continua y profesional, lista para ser insertada en la plantilla formal.
                    `;

                    const systemPrompt = "Act√∫a como un experto en redacci√≥n de Actas Policiales en Venezuela, cumpliendo con los est√°ndares de objetividad, formalidad, y legalidad (COPP). Tu tarea es transformar los datos clave y la descripci√≥n de hechos en una narraci√≥n continua, concisa y profesional, adecuada para el Cuerpo de Polic√≠a Nacional Bolivariana (PNB).";
                    await fetchAIResponse(systemPrompt, userQuery);

                } else if (selectedTool === 'generador_casos') {
                    const systemPrompt = "Genera un escenario de caso pr√°ctico (m√°ximo 150 palabras) para un ejercicio de pensamiento cr√≠tico. El caso debe involucrar el uso de Machine Learning o an√°lisis predictivo en un Cuadrante de Paz y plantear un dilema √©tico relacionado con el sesgo algor√≠tmico o la violaci√≥n de un principio humanista. El caso debe ser realista para el contexto PNB/UNES.";
                    await fetchAIResponse(systemPrompt, "Genera un caso de uso √©tico sobre IA en el Cuadrante de Paz.");
                }
            });

            // Inicializar la interfaz de IA en el modal
            updateAIInputInterface();

        });
    </script>
</body>
</html>
